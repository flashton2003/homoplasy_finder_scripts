from Bio import SeqIO
from collections import Counter

'''
1. take some genomic positions of interest
2. read in the whole genome alignment file
3. for the chinese sub-clades, how many have each allele.
'''

def read_in_alignment(whole_genome_alignment, chinese_subclades):
	chinese_subclades = set(chinese_subclades)
	seqs = []
	sequences = SeqIO.parse(whole_genome_alignment, 'fasta')
	for s in sequences:
		if s.id in chinese_subclades:
			seqs.append(s.seq)
	print len(seqs)
	return seqs

def read_positions(seqs, postions):
	for p in postions:
		alleles = [s[p] for s in seqs]
		alleles = dict(Counter(alleles))
		if 'A' not in alleles:
			alleles['A'] = 0
		if 'C' not in alleles:
			alleles['C'] = 0
		if 'T' not in alleles:
			alleles['T'] = 0
		if 'G' not in alleles:
			alleles['G'] = 0
		print '\t'.join(map(str, [p, alleles['A'], alleles['C'], alleles['G'], alleles['T']]))



def main(positions, whole_genome_alignment, chinese_subclades):
	seqs = read_in_alignment(whole_genome_alignment, chinese_subclades)
	read_positions(seqs, positions)

positions = [473822, 832109, 841495, 4154910, 4154910, 2631968, 2295943, 608037, 1481185, 964674, 842051, 842058, 3248028, 2123179, 475888, 2867298, 2631967, 1474, 2953581, 1341073, 2030758, 2030761, 2626348, 4060588, 3343411, 2122395, 2631574, 2631565, 2631556, 2631556, 2631495, 55553, 475833, 842063, 842065, 842111, 842057, 1254144, 1254144, 1441582, 4078056, 332787, 128621, 129058, 859460, 2904127, 1204, 4371399, 4371399, 877232, 956603, 4407630, 4407766, 4315327, 1130369, 2156110, 44734, 1688784, 2867145, 2867245, 2867251, 2867254, 414919, 1850024, 2675383, 1270229, 3187135, 252083, 252083, 852676, 2294903, 2294896, 2294912, 2630173, 2630176, 2630184, 3199304, 28357, 254833, 390984, 403406, 517479, 554131, 1075568, 1178343, 1253483, 1277738, 1701352, 1908229, 1980450, 2012864, 2075517, 2075517, 2278018, 2527025, 2528584, 2550014, 3135972, 3451134, 4097733, 4170368, 4171575, 4278965, 4384758, 3696631, 841016, 841244, 841562, 3203471]
whole_genome_alignment = '/home/ubuntu/external_tb/phylo/results/2019.11.04/all_tb/2019.11.04_all_L4_masked.fasta'
chinese_subclades = ['16285-ERR752123', '12036-SRR671832', '12327-ERR2179803', '12265-ERR2179741', '12320-ERR2179796', '16190-ERR751950', '15798-ERR718240', '10674-SRR5709841', '12258-ERR2179734', '12268-ERR2179744', '12269-ERR2179745', '12263-ERR2179739', '16332-ERR752202', '3684-02MTB0260', '10733-SRR5709904', '12218-ERR2179692', '12262-ERR2179738', '12267-ERR2179743', '12264-ERR2179740', '12259-ERR2179735', '16070-ERR751760', '12237-ERR2179712', '3799-02MTB0402', '9632-SRR5073623', '11126-SRR6480581', '4075-02MTB0732', '3672-02MTB0245', '9482-SRR5067398', '12210-ERR2179684', '12322-ERR2179798', '12323-ERR2179799', '3715-02MTB0297', '9019-SRR5065225', '9429-SRR5067274', '4290-02MTB0978', '3697-02MTB0277', '9063-SRR5065276', '9477-SRR5067382', '4490-02MTB1193', '4489-02MTB1193', '9834-SRR5067435', '12266-ERR2179742', '4084-02MTB0745', '3772-02MTB0371', '4206-02MTB0892', '4342-02MTB1045', '12331-ERR2179807', '4435-02MTB1141', '11986-SRR671782', '12247-ERR2179723', '16073-ERR751764', '10614-SRR5709781', '15827-ERR718281', '15996-ERR751645', '16250-ERR752060', '3802-02MTB0405', '9389-SRR5065690', '9580-SRR5067621', '9024-SRR5065230', '3773-02MTB0372', '9298-SRR5065578', '9777-SRR5065571', '9746-SRR5065399', '9462-SRR5067355', '9110-SRR5065335', '9511-SRR5067473', '4271-02MTB0954', '3797-02MTB0400', '4444-02MTB1151', '16398-ERR767961', '15911-ERR718434', '16313-ERR752171', '16469-ERR775806', '16421-ERR768022', '16221-ERR752017', '15829-ERR718284', '16395-ERR767957', '11170-SRR6480625', '12087-ERR171157', '12248-ERR2179724', '16196-ERR751963', '9707-SRR5065203', '3726-02MTB0314', '9250-SRR5065517', '9009-SRR5065214', '4213-02MTB0897', '10970-SRR6480425', '11968-SRR671764', '12334-ERR2179810', '12082-SRR671878', '11929-SRR671725', '12065-SRR671861', '12312-ERR2179788', '11309-ERR234183', '10891-SRR6480346', '12228-ERR2179702', '12224-ERR2179698', '12234-ERR2179708', '16023-ERR751685', '16203-ERR751978', '16068-ERR751756', '16305-ERR752151', '12256-ERR2179732', '11966-SRR671762', '12282-ERR2179758', '12279-ERR2179755', '16218-ERR752013', '9101-SRR5065323', '10835-SRR5710013', '10697-SRR5709866', '12227-ERR2179701', '12329-ERR2179805', '16331-ERR752201', '9559-SRR5067575', '4167-02MTB0843', '3795-02MTB0398', '12273-ERR2179749', '12311-ERR2179787', '12270-ERR2179746', '12242-ERR2179717', '12064-SRR671860', '16417-ERR768012', '10805-SRR5709981', '9571-SRR5067602', '9475-SRR5067377', '9026-SRR5065233', '3757-02MTB0353', '12272-ERR2179748', '12286-ERR2179762', '12232-ERR2179706', '11982-SRR671778', '12276-ERR2179752', '12280-ERR2179756', '12285-ERR2179761', '12277-ERR2179753', '12274-ERR2179750', '12275-ERR2179751', '12339-ERR2179815', '16123-ERR751838', '12328-ERR2179804', '15994-ERR751643', '15894-ERR718407', '9595-SRR5067652', '12230-ERR2179704', '12244-ERR2179720', '11964-SRR671760', '12039-SRR671835', '12254-ERR2179730', '12319-ERR2179795', '12225-ERR2179699', '12212-ERR2179686', '15818-ERR718269', '15777-ERR718205', '12229-ERR2179703', '11944-SRR671740', '12284-ERR2179760', '12281-ERR2179757', '12283-ERR2179759', '4295-02MTB0984', '16215-ERR752004', '11081-SRR6480536', '15982-ERR718559', '3801-02MTB0404', '3979-02MTB0618', '11994-SRR671790', '11953-SRR671749', '12035-SRR671831', '9036-SRR5065244', '10797-SRR5709972', '9077-SRR5065295', '9402-SRR5067224', '12066-SRR671862', '12223-ERR2179697', '10574-SRR5709740', '3918-02MTB0545', '9403-SRR5067225', '9634-SRR5073675', '3839-02MTB0450', '11107-SRR6480562', '9534-SRR5067515', '4102-02MTB0769', '9017-SRR5065223', '9921-SRR5074102', '9203-SRR5065463', '3755-02MTB0350', '9759-SRR5065455', '16228-ERR752028', '12222-ERR2179696', '9758-SRR5065453', '10654-SRR5709821', '10744-SRR5709915', '12236-ERR2179710', '11278-ERR234152', '16245-ERR752052', '16411-ERR767992', '16171-ERR751919', '9633-SRR5073627', '4198-02MTB0884', '4457-02MTB1162', '4456-02MTB1162', '9825-SRR5067384', '12095-ERR171165', '15915-ERR718443', '15840-ERR718303', '16334-ERR752206', '13810-ERR046892', '16096-ERR751801', '16272-ERR752105', '15788-ERR718219', '15935-ERR718477', '16114-ERR751827', '15927-ERR718464', '10668-SRR5709835', '10678-SRR5709845', '16277-ERR752111', '16253-ERR752065', '16282-ERR752117', '12357-ERR2179850', '12364-ERR2179857', '12306-ERR2179782', '12369-ERR2179862', '16147-ERR751882', '16193-ERR751955', '12315-ERR2179791', '12253-ERR2179729', '12293-ERR2179769', '12240-ERR2179715', '12308-ERR2179784', '12300-ERR2179776', '12288-ERR2179764', '12241-ERR2179716', '12290-ERR2179766', '12287-ERR2179763', '12257-ERR2179733', '11976-SRR671772', '12217-ERR2179691', '15836-ERR718298', '16029-ERR751693', '16113-ERR751825', '15990-ERR751639', '16217-ERR752011', '16453-ERR775774', '16362-ERR752248', '15938-ERR718480', '15804-ERR718248', '16188-ERR751948', '16281-ERR752116', '16261-ERR752084', '16358-ERR752242', '3994-02MTB0638', '9347-SRR5065639', '9345-SRR5065636', '16307-ERR752153', '12215-ERR2179689', '16315-ERR752174', '15872-ERR718361', '16418-ERR768015', '12246-ERR2179722', '11967-SRR671763', '12037-SRR671833', '12325-ERR2179801', '12252-ERR2179728', '16424-ERR768027', '15981-ERR718557', '15959-ERR718511', '16091-ERR751793', '11955-SRR671751', '12299-ERR2179775', '16044-ERR751714', '12335-ERR2179811', '11977-SRR671773', '12294-ERR2179770', '15977-ERR718545', '16014-ERR751670', '16269-ERR752097', '16327-ERR752194', '16111-ERR751821', '16388-ERR752280', '3834-02MTB0443', '12072-SRR671868', '16164-ERR751906', '16336-ERR752210', '16176-ERR751928', '16284-ERR752121', '15928-ERR718465', '16357-ERR752241', '12054-SRR671850', '12250-ERR2179726', '12249-ERR2179725', '12211-ERR2179685', '12216-ERR2179690', '4022-02MTB0670', '3956-02MTB0590', '9244-SRR5065508', '12050-SRR671846', '15862-ERR718342', '15885-ERR718391', '11972-SRR671768', '12057-SRR671853', '15769-ERR718192', '16173-ERR751922', '15890-ERR718400', '15914-ERR718442', '15943-ERR718488', '16174-ERR751923', '16275-ERR752109', '16455-ERR775776', '15815-ERR718264', '15883-ERR718384', '16381-ERR752272', '11970-SRR671766', '15918-ERR718450', '16416-ERR768009', '16156-ERR751895', '16237-ERR752041', '16377-ERR752268', '16097-ERR751802', '16287-ERR752126', '10796-SRR5709971', '15861-ERR718339', '15805-ERR718249', '16186-ERR751945', '16095-ERR751800', '16359-ERR752243', '15961-ERR718515', '16110-ERR751820', '16247-ERR752055', '16467-ERR775804', '15834-ERR718296', '15796-ERR718234', '16166-ERR751910', '15865-ERR718349', '15906-ERR718427', '16223-ERR752021', '16279-ERR752113', '16074-ERR751766', '16434-ERR768044', '14139-ERR400491', '12352-ERR2179845', '12342-ERR2179835', '12332-ERR2179808', '12345-ERR2179838', '12307-ERR2179783', '12326-ERR2179802', '12318-ERR2179794', '12213-ERR2179687', '12295-ERR2179771', '12251-ERR2179727', '12235-ERR2179709', '10775-SRR5709947', '12333-ERR2179809', '12239-ERR2179714', '12317-ERR2179793', '12309-ERR2179785', '12291-ERR2179767', '12340-ERR2179833', '12301-ERR2179777', '12245-ERR2179721', '12330-ERR2179806', '12238-ERR2179713', '12302-ERR2179778', '12310-ERR2179786', '12304-ERR2179780', '12255-ERR2179731', '12305-ERR2179781', '12297-ERR2179773', '12316-ERR2179792', '12042-SRR671838', '14162-ERR400514', '14161-ERR400513', '14159-ERR400511', '12350-ERR2179843', '12313-ERR2179789', '12076-SRR671872', '12344-ERR2179837', '12355-ERR2179848', '12362-ERR2179855', '14541-SRR5341389', '14436-SRR5341284', '14171-ERR400523', '12368-ERR2179861', '12361-ERR2179854', '12356-ERR2179849', '12078-SRR671874', '12243-ERR2179719', '12314-ERR2179790', '12289-ERR2179765', '16121-ERR751835', '16401-ERR767972', '12324-ERR2179800', '12336-ERR2179812', '12338-ERR2179814', '15978-ERR718546', '12214-ERR2179688', '16474-ERR846995', '11971-SRR671767', '12296-ERR2179772', '12292-ERR2179768', '12298-ERR2179774', '11973-SRR671769', '11978-SRR671774', '16499-ERR3256132', '10973-SRR6480428', '11120-SRR6480575', '11961-SRR671757', '11003-SRR6480458', '11954-SRR671750', '9272-SRR5065546', '4254-02MTB0933', '16208-ERR751989', '16268-ERR752096', '12220-ERR2179694', '10963-SRR6480418', '11030-SRR6480485', '10935-SRR6480390', '3815-02MTB0420', '12226-ERR2179700', '3733-02MTB0323', '15800-ERR718242', '16180-ERR751937', '9044-SRR5065254', '15858-ERR718335', '9034-SRR5065242', '4264-02MTB0945', '16043-ERR751713', '16470-ERR775807', '16206-ERR751983', '16169-ERR751913', '16441-ERR775755', '12231-ERR2179705', '11127-SRR6480582', '12063-SRR671859', '3849-02MTB0463', '12337-ERR2179813', '16497-ERR3256130', '10577-SRR5709743', '4225-02MTB0907', '9831-SRR5067415', '4224-02MTB0907', '11093-SRR6480548', '9463-SRR5067358', '3978-02MTB0616', '10679-SRR5709846', '11357-ERR234244', '9056-SRR5065268', '16518-ERR3256151', '16013-ERR751668', '16456-ERR775777', '16195-ERR751960', '3827-02MTB0435', '15832-ERR718293', '9165-SRR5065417', '10794-SRR5709969', '9791-SRR5065649', '9096-SRR5065316', '9853-SRR5067569', '4237-02MTB0916', '4238-02MTB0916', '9608-SRR5067685', '9465-SRR5067361', '12221-ERR2179695', '10989-SRR6480444', '11080-SRR6480535', '15983-ERR718560', '16475-ERR846996', '16353-ERR752233', '11356-ERR234243', '9332-SRR5065622', '9966-SRR5074165', '15963-ERR718517', '3848-02MTB0462', '4261-02MTB0941', '9802-SRR5065698', '11091-SRR6480546', '4399-02MTB1104', '4400-02MTB1104', '9868-SRR5067674', '10957-SRR6480412', '10983-SRR6480438', '16607-ERR3256244', '12219-ERR2179693']

if __name__ == '__main__':
	main(positions, whole_genome_alignment, chinese_subclades)
